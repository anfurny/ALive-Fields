<?PHP
require_once("../includes/alex_functions.php");
require_once("../includes/dispatch_functions.php");
 	validate_logged_in();
require("dhtmlxConnector/grid_connector.php");
require("dhtmlxConnector/db_mssql.php");

$res = database_connect();
 
$DispatchID = (int) $_GET['DispatchID'] ; // Yes, Get
$InterpID = (int) $_POST['c3']; // Yes, post

  // $config = new GridConfiguration();
  // $config->setEditable(true);
   //$gridConn->set_config($config);
   $gridConn = new GridConnector($res,"MsSQL");
   
	$gridConn->set_encoding("iso-8859-1");
	    
	if (isset( $_POST['!nativeeditor_status'] ) && ( $_POST['!nativeeditor_status'] == "updated"))
		{
		$sql = "UPDATE InterpContact set Declined = " . (int)$_POST['c2'] . " WHERE InterpID='" . $InterpID  . "' AND DispatchID='" . $DispatchID . "'"; //YES get on the last one
		database_query($sql);
		header("Content-type: text/xml");//include XML Header (as response will be in xml format)
		 echo('<?xml version="1.0" encoding="iso-8859-1"?>'); //encoding may be different in your case
		echo '  <data>     <action type="update" sid="' . $_POST['gr_id'] . '" tid="' . $_POST['gr_id'] . '" />  </data>';
		}
	else
 	 	 $gridConn->render_sql("SELECT FirstName, LastName, Declined, DispatchID, InterpContact.InterpID 
FROM InterpContact INNER JOIN Interpreter ON InterpContact.InterpID = Interpreter.InterpID
WHERE ((InterpContact.Declined=1) and (DispatchID = " . (int)$DispatchID . "))", "", "FirstName,LastName,Declined,InterpID,DispatchID");

	
?>