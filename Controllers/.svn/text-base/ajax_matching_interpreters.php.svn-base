<?PHP 

require_once( "../includes/alex_functions.php"); 
require_once("../includes/dispatch_functions.php");
 	validate_logged_in();
include "ajax_table.php";
error_reporting(E_ERROR | E_PARSE);
set_error_handler (xml_error, E_ERROR | E_PARSE);
set_time_limit(10);


$var = json_decode($_GET['request']);
$filters = json_decode($_GET['filters']);
$filter_code = filters_to_sql($filters);

$sql = "SELECT TOP 100 " . 
//output data from DB as XML
//$sql = "SELECT  TOP 10 * from Dispatch ";
//not gonna fiddle with adding joins to a query that isn't permanent yet

/*,  Dispatch.InterpID, Dispatch.InterpConfirmed, Dispatch.CustCanceled, Dispatch.Started, Client.CustID,  Dispatch.ControlNo,    Dispatch.CustConfirmed,  Dispatch.Comments, Dispatch.InvoiceNotes, Client.CustField3, Client.CustField4" */

//. " ((((select distinct clientID from dispatch where Scheduled > '2/3/2006' and dispatch.clientID=Client.clientid)) Is Not Null)) " 

" Dispatch.DispatchID, -1, Client.Language, Dispatch.FacilityID, Dispatch.SituID, Client.ClientLName,  Client.ClientFName, Client.MedicalNo, Dispatch.Location, Dispatch.SpecialInstruction, Dispatch.ContactPerson, Client.BudgetNo, -1, Dispatch.Caller, Dispatch.CallerPhone, Dispatch.CallerEMail, Dispatch.Ongoing, Dispatch.Urgent, Dispatch.SchedEnd,
-1, Dispatch.RecievedBy, Dispatch.Recieved, Dispatch.ClientID, Dispatch.Latitude, Dispatch.Longitude, Dispatch.Billable, Dispatch.Payable, -1, -1, Dispatch.InvoiceNotes, Dispatch.Scheduled, 5555" . " FROM [Dispatch] INNER JOIN [Client] ON Dispatch.ClientID = Client.ClientID
WHERE " 
. " (1 = 1 ) " . " AND " . $filter_code 
. " ORDER BY Dispatch.Scheduled DESC";

header('Content-Type: text/html; charset=iso-8859-1'); //$DEBUG = true; 
if (! $DEBUG)
	;//xmlHeader();
else
	echo " a";

echo query_to_json($sql);


?>