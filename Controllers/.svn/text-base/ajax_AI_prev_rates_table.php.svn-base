<?PHP 
require_once( "../includes/alex_functions.php"); 
require_once("../includes/dispatch_functions.php");

 	validate_logged_in();
include "ajax_table.php";

function custom_error_handler($a,$b,$c,$d) { return xml_error($a,$b,$c,$d);}

error_reporting(E_ERROR | E_PARSE);
//set_error_handler (xml_error, E_ERROR | E_PARSE);
set_time_limit(10);

//$filters = json_decode($_GET['filters'], true);
$filter_code = filters_to_sql($filters);

$InterpID = (int)$_GET["InterpID"];
//echo "Dispatch id : $DispatchID";
//SELECT Invoice.DispatchID, CustItems.ItemCode, Invoice.Cost, Invoice.Quantity, Invoice.PayQty, 
//CustItems.Description, Invoice.InterpRate, Invoice.InvHdrID
//FROM Invoice INNER JOIN CustItems ON Invoice.CustItemID = CustItems.CustItemID;

//$sql = "SELECT  CustItems.ItemCode, Description, Invoice.Quantity, '$' + CAST(Invoice.Cost as char), Invoice.PayQty, '$' + CAST(InterpRate as char) as InterpRate FROM Invoice INNER JOIN CustItems ON Invoice.CustItemID = CustItems.CustItemID WHERE DispatchID = '$DispatchID' " ;


$sql = "SELECT TOP 10 Convert(varchar(100), Dispatch.Scheduled, 100), Interpreter.InterpID, ItemCode, InterpRate, Dispatch.DispatchID, CustID 
FROM Interpreter 
INNER JOIN Dispatch on Dispatch.InterpID = Interpreter.InterpID
INNER JOIN Invoice on Invoice.DispatchID = Dispatch.DispatchID
INNER JOIN CustItems on CustItems.CustItemID = Invoice.custItemID

WHERE datediff(day, getDate(), Dispatch.Scheduled) < 0
--and datediff(day, getDate(), Dispatch.Scheduled) > -30
AND ItemCode in ('NC_Int', 'ASL_Int', 'Asl_Cert')
And Interpreter.InterpID = " . (int)$InterpID  . "
ORDER BY Dispatch.Scheduled DESC";

//echo $sql; 
if (! $DEBUG)
	;//xmlHeader();
else
	{
	header("Content-type: text/html");
	echo " a - " . $sql;
	}

echo query_to_json($sql);


?>