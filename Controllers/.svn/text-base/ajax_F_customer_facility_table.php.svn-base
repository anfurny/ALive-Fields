<?PHP 
require_once( "../includes/alex_functions.php"); 
require_once("../includes/dispatch_functions.php");
 	validate_logged_in();
include "ajax_table.php";

function custom_error_handler($a,$b,$c,$d) { return xml_error($a,$b,$c,$d);}

error_reporting(E_ERROR | E_PARSE);
set_error_handler (custom_error_handler, E_ERROR | E_PARSE);
set_time_limit(20);

$var = json_decode($_GET['request'], true);
$filters = json_decode($_GET['filters'], true);
$filter_code = filters_to_sql($filters);

$InterpID = $var["InterpID"];
$requestNo = $var["requestNo"];


$sql = " SELECT TOP 1000 Customer.CustID, CustomerName, FacilityID, Facility.Name, Facility.Address, Facility.City, Facility.State 
FROM Customer 
LEFT JOIN  Facility
 on Customer.CustID = Facility.CustID WHERE "; 
$sql .= $filter_code;
$sql .= " ";

header('Content-Type: text/html; charset=iso-8859-1'); //$DEBUG = true; 
if (! $DEBUG)
	;//xmlHeader();
else
	{
	header("Content-type: text/html");
	echo " a - " . $sql;
	}

echo query_to_json($sql);


?>