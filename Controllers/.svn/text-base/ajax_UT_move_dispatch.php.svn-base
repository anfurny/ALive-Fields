<?PHP
require_once( "../models/ActionRecord.php");
require_once( "../includes/alex_functions.php");
require_once("../includes/dispatch_functions.php");
require_once("../Controllers/MoveDispatch.php");

validate_logged_in();

function custom_error_handler($a,$b ="",$c ="",$d ="") { json_error($a . $b . $c . $d); return false;}
error_reporting(0);

$DEBUG = false;
if ( ! $DEBUG)
	 set_error_handler ("custom_error_handler", E_ERROR | E_PARSE | E_ALL);
 else 
 	echo "DEBUG IS ON";
	
set_time_limit(10);
$var = json_decode($_GET["request"], true);

database_connect();
$tmp = moveDispatch((int)$var["DispatchID"], (int)$var["CustID"], (bool)$var["keepAssignment"],  (bool)$var["reinvoice"]);

if (!$tmp)
	$tmp = array("criticalError" => "This dispatch cannot be moved because it is attached to a facility that has no equivalent for the new customer. This would affect mileage etc.");
	
echo json_encode($tmp);
?>