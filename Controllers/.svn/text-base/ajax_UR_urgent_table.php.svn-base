<?PHP
require_once("../includes/alex_functions.php"); 
require_once("../includes/dispatch_functions.php");
 	validate_logged_in();
require("dhtmlxConnector/grid_connector.php");
require("dhtmlxConnector/db_mssql.php");

header("Cache-Control: no-cache, must-revalidate"); // HTTP/1.1
header("Expires: Sat, 26 Jul 1997 05:00:00 GMT"); // Date in the past	

$res = database_connect();

$DispatchID = (int) $_POST['c3']; // Yes, post

  // $config = new GridConfiguration();
  // $config->setEditable(true);
   //$gridConn->set_config($config);
	if (isset( $_POST['!nativeeditor_status'] ) && ( $_POST['!nativeeditor_status'] == "updated"))
		{
		$sql = "UPDATE Dispatch set Urgent = " . (int)$_POST['c0'] . " WHERE DispatchID='" . $DispatchID  . "' "; 
		database_query($sql);
		recordDataChange($DispatchID, "UPDATE", "Dispatch", "Urgent", (int)$_POST['c0']);

		header("Content-type: text/xml");//include XML Header (as response will be in xml format)
		echo('<?xml version="1.0" encoding="iso-8859-1"?>'); //encoding may be different in your case
		echo '  <data>     <action type="update" sid="' . $_POST['gr_id'] . '" tid="' . $_POST['gr_id'] . '" />  </data>';
		}
	else
		{
	    $gridConn = new GridConnector($res,"MsSQL");   
		$gridConn->set_encoding("iso-8859-1");
		//
 	 	 $gridConn->render_sql("SELECT Urgent,  Dispatch.Comments, Convert(varchar(100), Dispatch.Scheduled, 100) as Scheduled,  DispatchID,  Facility.City, Client.Language, Dispatch.DispatchID, Client.CustID
FROM (Dispatch LEFT JOIN Client ON Dispatch.ClientID = Client.ClientID) LEFT JOIN Facility ON Dispatch.FacilityID = Facility.FacilityID WHERE (((Dispatch.Urgent)=1));", "", "Urgent,Comments,Scheduled,DispatchID,City,Language,CustID");
		}

	
?>